{
  "notes": "第79轮（迭代3）：纯修复/优化，无新功能。共6个commit（网络问题未push，下轮先push）：\n1. StatsPanel双重遍历→单次遍历；Toolbar粒子计数节流每10帧；Renderer.renderFloatingSelection循环外提取fillStyle；添加vite.config.ts消除chunk警告\n2. InputHandler: floodFill用头指针替代O(n)的shift()；getDrawMaterial缓存随机材质列表\n3. computePressure改为按需执行（needsPressure标志，默认false）\n4. Clay.ts: Map<string,number>→World内置age\n5. Smoke/Steam/Spark: Map<string,number>→World内置age（swap自动迁移）\n6. Poison/Lightning: Map<string,number>→World内置age\n剩余Map用户：Plant/Philosopher/Firework（消耗型能量，逻辑复杂，暂缓）",
  "priorities": [
    "1. 下轮开始前先 git push origin main（本轮6个commit未推送）",
    "2. Plant.ts/Philosopher.ts/Firework.ts 仍使用 Map<string,number>，可继续优化",
    "3. 继续检查其他材质文件的代码质量问题",
    "4. 每次提交前先检查main.ts无重复（用grep uniq -d命令），每轮先git pull"
  ],
  "lessons": "1. computePressure每帧全量遍历但只有压力叠加层用到，改为按需执行。2. Map<string,number>用字符串key存粒子状态是反模式，应改用World内置TypedArray。3. World.swap()自动迁移age，用age替换Map后无需手动迁移。4. 对countdown型生命值，用概率死亡检查替代精确countdown（Smoke/Steam/Spark）。5. StatsPanel.refresh()原先双重遍历cells，合并为单次遍历。6. 每次开始前先git pull避免合并冲突。7. 检测重复导入：grep -n \"import './materials/\" main.ts | awk -F\"'\" '{print $2}' | sort | uniq -d",
  "last_updated": "2026-02-27T18:30:00+08:00"
}
