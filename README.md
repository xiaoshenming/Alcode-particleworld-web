# Particle World

基于物理引擎的粉末沙盒模拟游戏，纯浏览器运行。

## 在线体验

```bash
npm install
npm run dev
```

浏览器打开 `http://localhost:5173`

## 材质系统（30 种）

| 分类 | 材质 | 行为 |
|------|------|------|
| 粉末 | 沙子、种子、雪、泥土、火药、盐、烟花、炼金石 | 受重力下落，可堆积 |
| 液体 | 水、油、酸液、熔岩、盐水、液蜡 | 流动、密度分层、化学反应 |
| 气体 | 火、烟、蒸汽、雷电、毒气、氢气、火花 | 上升飘散，有生命周期 |
| 固体 | 石头、木头、金属、植物、冰、玻璃、黏土、蜡、橡皮泥、金、钻石 | 不移动，作为障碍物 |
| 工具 | 空气（橡皮擦） | 擦除粒子 |

## 化学反应

- 火 + 可燃物（木头/油/植物） → 蔓延燃烧
- 火 + 水 → 蒸汽
- 蒸汽冷却 → 凝结为水（30%）或消散
- 酸液 + 大部分材质 → 溶解（金属免疫）
- 熔岩 + 水 → 石头 + 蒸汽
- 熔岩 + 可燃物 → 点燃
- 种子 + 水 + 固体地面 → 植物生长
- 雪/冰 + 火/熔岩/蒸汽 → 融化为水
- 冰 + 相邻水 → 扩散冻结
- 雷电 + 沙子 → 玻璃
- 雷电 + 可燃物 → 点燃
- 雷电 + 水 → 蒸汽
- 毒气 + 植物 → 烟（杀死植物）
- 毒气 + 水 → 被吸收净化
- 氢气 + 火/熔岩/雷电 → 爆炸（链式引爆）
- 酸液 + 玻璃 → 腐蚀
- 盐 + 水 → 溶解为盐水
- 盐水 + 高温 → 蒸汽 + 析出盐
- 蜡 + 高温/火 → 融化为液蜡
- 液蜡 + 冷却 → 凝固为蜡
- 液蜡/蜡 + 火 → 燃烧
- 烟花 + 火/熔岩 → 点燃上升后爆炸产生火花
- 炼金石 + 金属 → 金
- 炼金石 + 石头 → 钻石
- 炼金石 + 沙子 → 玻璃
- 炼金石 + 泥土 → 种子

## 操作

- 鼠标左键拖拽绘制粒子
- 左侧面板选择材质（分类显示）
- 滑块调节笔刷大小（1~10）
- 鼠标滚轮快速调整笔刷大小
- 笔刷预览：悬停时显示圆形范围
- Space 快捷键暂停/继续
- 模拟速度滑块（1x~5x）
- 保存/加载按钮（localStorage 存档）
- 清空按钮重置世界
- 右下角显示 FPS

## 技术架构

- TypeScript + Vite，零运行时依赖
- 200x150 网格，4x 像素缩放，Canvas 2D 渲染
- TypedArray 存储（Uint8Array 材质 ID + Uint32Array ABGR 颜色）
- 双缓冲活跃标记系统，静止粒子跳过更新
- 材质注册表模式，新材质只需实现 `MaterialDef` 接口

## 版本历史

- v2.7 - 炼金石材质：魔法转化（金属→金、石头→钻石、沙子→玻璃）
- v2.6 - 橡皮泥材质：可塑性固体，粘性下落不散开
- v2.5 - 烟花材质：点燃后上升爆炸产生彩色火花
- v2.4 - 蜡烛与蜡：固体蜡高温融化为液蜡，液蜡可燃可凝固
- v2.3 - 盐与盐水：盐溶于水变盐水，盐水蒸发析出盐
- v2.2 - 快捷键升级：数字键选材质、方括号调笔刷、加减号调速度
- v2.1 - 风力系统：可调风向和强度，影响气体和轻粒子
- v2.0 - 温度系统：热传导、蒸发、结冰、融化
- v1.9 - 火药材质：可被火/熔岩/雷电引爆
- v1.8 - 泥土与黏土：泥土遇水变黏土，黏土可烧制
- v1.7 - 存档系统：保存/加载世界状态到 localStorage（RLE 压缩）
- v1.6 - UI 交互升级：笔刷预览、滚轮调整、快捷键、模拟速度控制
- v1.5 - 毒气 + 氢气：有毒气体杀死植物，氢气遇火爆炸
- v1.4 - 雷电 + 玻璃：闪电熔化沙子为玻璃，点燃可燃物
- v1.3 - 冰 + 雪：冻结扩散、融化反应
- v1.2 - 性能优化：活跃粒子追踪，跳过静止粒子
- v1.1 - UI 升级：分类面板、暂停/清空、粒子计数
- v1.0 - 植物生长系统：种子 + 植物
- v0.9 - 金属 + 熔岩材质
- v0.8 - 蒸汽凝结 + 酸液腐蚀
- v0.7 - 火与烟 + 化学反应系统
- v0.6 - 可燃材质：木头 + 油
- v0.5 - 固体材质：石头 + 橡皮擦
- v0.4 - 液体物理：水的流动 + 密度分层
- v0.3 - 交互系统：鼠标绘制 + 材质工具栏
